services:
  # Backend build for Cloud Run (default)
  backend:
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    image: ${GCP_REGION}-docker.pkg.dev/${GCP_PROJECT_ID}/${GCP_REPO}/trashmapr-backend:${COMMIT_HASH}

  # Worker build for Cloud Run
  worker:
    build:
      context: ./worker
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    image: ${GCP_REGION}-docker.pkg.dev/${GCP_PROJECT_ID}/${GCP_REPO}/trashmapr-worker:${COMMIT_HASH}
    profiles:
      - worker
